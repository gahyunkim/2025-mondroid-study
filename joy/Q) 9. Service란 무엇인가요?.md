# Q) 9. Service란 무엇인가요?

## Service란?

안드로이드의 4대  컴포넌트 중 하나이며, 사용자와 상호작용하지 않고 백그라운드에서 오래 실행되는 작업을 수행할 수 있는 애플리케이션 구성 요소이다. 

**백그라운드에서 장기 실행 작업을 실행할 수 있는 애플리케이션 구성 요소**

- 서비스는 **background, foreground, Bound**로 구현할 수 있다.
- 서비스 시작 방식으로는 **startService(), bindService()**가 있다.

### Service의 사전적 의미 / IT에서의 사전적 의미

- 누군가가 하는 일이나 누군가가 조직을 위해 일하는 시간
- 서비스는 백그라운드에서 장기 실행 작업을 수행할 수 있는 응용 프로그램 구성 요소이며, 사용자 인터페이스를 제공하지 않는다.
- 다른 응용 프로그램 구성 요소는 서비스를 시작할 수 있고, 사용자가 다른 응용 프로그램으로 전환하더라도 백그라운드에서 계속 실행된다.

### Service는 왜 필요한가?

- 사용자가 보고 있는 화면이 종료된 상태에서도 개발자는 해당 기능을 구현해야 하기 때문이다.
- MP3와 같은 기능을 활용하는 경우, 화면이 종료된 상태에서도 게속 노래를 재생해야 하기 때문에 Background에서도 동작하도록 만들어야한다.

### Service의 특징

- 서비스는 앱이 죽지 않도록(작업이 중단되지 않도록) 도움을 줄 수 있다.
    - 서비스의 종류에 따라 앱의 우선순위를 높여준다.
    - 시스템은 메모리가 부족할 때 LMK(Low Memory Killer)가 우선순위가 낮은 프로세스를 종료한다.
- 서비스는 UI 스레드에서 실행된다.
    - 백그라운드 상에서 동작한다고 하더라도, 기본적인 작업은 UI 스레드에서 실행되기 때문에 무거운 작업은 서비스 내에서 별도로 스레드를 생성해서 진행하는 것이 좋다.

### Service 선언

```kotlin
<manifest ... >
  ...
  <application ... >
      <service android:name=".ExampleService" />
      ...
  </application>
</manifest>
```

- 액티비티나 다른 구성요소들처럼 애플리케이션의 매니페스트 파일에서 서비스를 위와 같이 선언해주어야한다.
- android:name 속성은 유일한 필수 속성으로, 서비스의 클래스 이름을 지정하기 위해 사용한다.

> 앱을 안전하게 사용하기 위해서는 Service를 시작할때 항상 명시적 인텐트를 사용하고 서비스에 인텐트 필터를 선언하지 말아야 한다. 암시적 인텐트를 사용해 서비스를 시작하면 어떤 서비스가 인텐트에 응답할 지 확신할 수 없기 때문이다.
> 

## StartService() vs BindService()

### StartService()

- 앱 내의 액티비티 같은 컴포넌트가 호출했을 때 실행된다.
- 백그라운드에서 한가지 일을 하고, 결과를 호출했던 컴포넌트에게 보내지 않는다.
- 예를 들어 다운로드나, 파일을 업로드 하는 것들이 있다.

<aside>
🚨

startService()는 Android 8(API 26) 이상부터 제한된다.

- Android 8.0(API 26) 이상부터는 앱이 백그라운드 상태일 때 일반 `startService()` 호출은 제한됨.
- 반드시 `startForegroundService()`로 시작하고, 5초 이내에 `startForeground()` 호출이 필요하다.
</aside>

### BindService()

- 자신을 호출했던 컴포넌트와 인터랙션을 주고받을 수 있다.
- 처리한 결과를 주고받을 수 있고 서로 다른 프로세스 상에 있어도 이 처리가 가능하다.

## 가시성에 따른 Service의 분류

### foreground Service

- 사용자에게 보여지는 작업을 수행한다. → 알림(Notification)
    - 사용자에게 보여져야 하기 때문에 무조건 Notification을 표시해야 한다.
- 다른 앱을 실행하고 있어도 그 위에 오디오 트랙을 재생시키는 것 처럼 startService()로 호출되고, onStartCommand()로 실행된다.
- 프로세스의 우선순위가 가장 높다.
- 이 서비스를 활용해서 죽지 않는 서비스를 구현할 수 있다.
- 포그라운드라서 백그라운드 보다 더 높은 우선순위가 매겨지기 때문에, 리소스 문제로 삭제당하는 우선순위가 높지 않다.

### background Service

- 이름 그대로 사용자에게 보여지지 않는 작업을 수행한다.
- startService()로 호출되고, onStartCommand로 실행된다
- 프로세스의 우선순위가 낮은 편이기 때문에 시스템 리소스가 부족할 때 삭제될 확률이 높다.

## 성격에 따른 Service의 분류

서비스는 콜백메서드의 구현 혹은 서비스를 실행시키는 방식에 따라 구분되기도 한다. 

### Started Service

- 어떤 컴포넌트에서 startService()를 통해서 시작된 서비스를 뜻한다. 서비스에 정의된 작업을 어떤 컴포넌트가 수행하고자 할 때 호출한다.

### bound Service

- bindService()를 호출해서 응용 프로그램 구성 요소가 바인딩 될 때 서비스가 바인딩 된다.
    - 즉, 두개 이상의 컴포넌트를 서로 연결해 놓는 것을 의미한다.
- 바인딩 된 서비스는 구성 요소가 서비스와 상호작용하고, 요청을 보내고, 결과를 받고, 프로세스 간 통신을 통해 프로세스 간에 수행할 수 있는 클라이언트 - 서버 인터페이스를 제공한다.
- 서비스-클라이언트(액티비티) 구조에 가장 적합한 형태의 서비스라고 할 수 있다.

## Service의 생명주기
<img width="401" height="512" alt="image" src="https://github.com/user-attachments/assets/22194fed-b524-46ba-aad4-277d0a2cf8ba" />


### onCreate()

- 시스템에서 서비스를 처음 생성할 때 onCreate() 메서드를 호출한다. → 일회성임
- onStartCommand() 혹은 onBind()를 호출하기 이전에 호출되며, 서비스가 이미 실행중일 경우에는 이 메서드는 호출되지 않는다.

### onStartCommand()

- 다른 컴포넌트가 서비스를 시작하도록 요청하는 경우 호출되는 콜백 메서드이다.
- 시스템에서 액티비티와 같이 다른 컴포넌트에서 startService()를 호출하게 되면 onStartCommand()가 같이 실행되고 서비스가 시작된다.
- 처음 서비스가 만들어질때 onCreate()가 실행되기 때문에 한번 실행된 이후에는 onStartCommand()가 호출된다.
- 따라서, 계속 실행되는 onStartCommand()에 중요한 내용을 작성한다.
- 서비스가 시작되면 백그라운드에서 무한히 실행될 수 있기 때문에 중단을 위해서 stopSelf() 또는 stopService()를 호출해 중단할 수 있다.

### onBind()

- 시스템에서 액티비티와 같이 다른 컴포넌트에서 bindService()를 호출하면 onBind() 메서드가실행되고, 서비스에 바인딩 된다.
- bindService()로 서비스를 호출하게 되면 무조건 항상 이 메서드를 구현해야 한다.

### onDestroy()

- 시스템에서 서비스가 더 이상 사용되지 않거나, 서비스를 제거할 때 이 메서드를 호출한다.
- 서비스가 실행한 스레드, 리스너, 리시버 등 리소스를 삭제하기 위한 동작이 구현되어야 한다.
